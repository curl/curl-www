netrc and redirect credential leak
==================================

Project curl Security Advisory, December 11th 2024 -
[Permalink](https://curl.se/docs/CVE-2024-11053.html)

VULNERABILITY
-------------

When asked to both use a `.netrc` file for credentials and to follow HTTP
redirects, curl could leak the password used for the first host to the
followed-to host under certain circumstances.

This flaw only manifests itself if the netrc file has an entry that matches
the redirect target hostname but the entry either omits just the password or
omits both login and password.

INFO
----

A curl transfer with `a.tld` that redirects to `b.tld` that uses a `.netrc`
like below (with a match, but no password specified for the second host),
would make curl pass on `alicespassword` as password even in the second
transfer to the separate host `b.tld`.

~~~
machine a.tld
  login alice
  password alicespassword

default
  login bob
~~~

This bug is **not** considered a *C mistake*. It is not likely to have been
avoided had we not been using C.

This flaw also affects the curl command line tool.

The Common Vulnerabilities and Exposures (CVE) project has assigned the name
CVE-2024-11053 to this issue.

CWE-200: Exposure of Sensitive Information to an Unauthorized Actor

Severity: Low

AFFECTED VERSIONS
-----------------

- Affected versions: curl 7.76.0 to and including 8.11.0
- Not affected versions: curl < 7.76.0 and >= 8.11.1
- Introduced-in: https://github.com/curl/curl/commit/46620b97431e19c53ce82e5

libcurl is used by many applications, but not always advertised as such!

SOLUTION
------------

- Fixed-in: https://github.com/curl/curl/commit/e9b9bbac22c26cf6731
- Also-apply: https://github.com/curl/curl/commit/9fce2c55d4b0273ac99

The fix also addresses a few other .netrc related issues. The fix caused a
regression that was fixed by the second commit `9fce2c5`.

### For curl versions before 8.11.0

Proper functionality of the fixes also requires the `9bee39b` commit, 
available since version 8.11.0. Without it, the newly added `test479` fails, 
leaking the original password (only) on redirect.

- Also-apply: https://github.com/curl/curl/commit/9bee39bfed2c413b4cc

RECOMMENDATIONS
---------------

We suggest you take one of the following actions immediately, in order of
preference:

 A - Upgrade curl and libcurl to 8.12.0 or later.

 B - Upgrade curl and libcurl to version 8.11.1 and apply the second patch
     via `git cherry-pick 9fce2c5`.

 C - Apply all necessary patches to your curl version and rebuild.

 D - Avoid using netrc together with redirects.

TIMELINE
---------

This issue was reported to the curl project on November 8, 2024. We contacted
distros@openwall on December 3, 2024.

curl 8.11.1 was released on December 11 2024 around 06:00 UTC, coordinated
with the publication of this advisory.

CREDITS
-------

- Reported-by: Harry Sintonen
- Patched-by: Daniel Stenberg

Thanks a lot!
