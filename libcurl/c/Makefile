
ROOT= ../..

SRCROOT=$(ROOT)/cvssource
DOCROOT=$(SRCROOT)/docs
MANROOT=$(DOCROOT)/libcurl
OPTMAN=$(DOCROOT)/libcurl/opts

include $(ROOT)/mainparts.mk
include $(ROOT)/setup.mk

MAINPARTS += _menu.html doclinks.t Makefile $(ROOT)/manpage.t $(ROOT)/alert.t
FCPP_OPTS = -DSHOW_ALERT

# the files the opts pages depend on
MANPARTS = $(MAINPARTS)

MAN2HTMLBASIC = roffit --bare --mandir=$(MANROOT) --mandir=$(OPTMAN) --mandir=$(DOCROOT)
# postprocess the roffit HTML to add links to curl error codes
MAN2HTML= ( $(MAN2HTMLBASIC) | perl -0x20 -pe '/(CURL(E|M|SHE)_\w*)/; $$err=$$erra=$$1; $$erra =~ s/_//g; s@CURL(E|M|SHE)_\w*@<a href="libcurl-errors.html\#$$erra">$$err</a>@;' )

# generated by mkexam.pl, assignes the EXAMPLES variable
include Makefile.exhtml

C = CURLOPT_

# run mkopts.pl to generate the Makefile.opt* files
include Makefile.opttargets

opts = $(OPTPAGES)

MIME = curl_mime_init.html curl_mime_free.html curl_mime_addpart.html	\
 curl_mime_name.html curl_mime_data.html curl_mime_data_cb.html		\
 curl_mime_filedata.html curl_mime_filename.html			\
 curl_mime_subparts.html curl_mime_type.html curl_mime_headers.html	\
 curl_mime_encoder.html

URLAPI = curl_url.html curl_url_cleanup.html curl_url_dup.html	\
 curl_url_get.html curl_url_set.html

PAGES = index.html example.html curl_easy_init.html curl_easy_cleanup.html    \
 curl_easy_setopt.html curl_easy_perform.html curl_version.html		      \
 curl_version_info.html curl_getenv.html curl_free.html			      \
 curl_slist_append.html curl_slist_free_all.html curl_formadd.html	      \
 curl_getdate.html curl_easy_getinfo.html curl_formfree.html curl_escape.html \
 curl_unescape.html curl_strequal.html curl_mprintf.html libcurl.html	      \
 curl_global_init.html curl_global_init_mem.html curl_global_cleanup.html     \
 libcurl-errors.html curl_multi_add_handle.html curl_multi_init.html	      \
 curl_multi_cleanup.html curl_multi_perform.html curl_multi_fdset.html	      \
 curl_multi_remove_handle.html curl_multi_info_read.html libcurl-multi.html   \
 libcurl-easy.html libcurl-share.html allfuncs.html curl_share_cleanup.html   \
 curl_share_init.html curl_share_setopt.html curl_easy_duphandle.html	      \
 curl_easy_strerror.html curl_multi_strerror.html curl_share_strerror.html    \
 libcurl-tutorial.html curl_easy_reset.html curl_multi_socket.html	      \
 curl_multi_timeout.html curl_multi_setopt.html curl_easy_escape.html	      \
 curl_easy_unescape.html curl_multi_assign.html curl_formget.html	      \
 curl_easy_pause.html curl_easy_recv.html curl_easy_send.html		      \
 curl_multi_socket_action.html curl_multi_wait.html $(EXAMPLES) $(opts)	      \
 easy_setopt_options.html easy_getinfo_options.html multi_setopt_options.html \
 allexamples.zip options-in-examples.html symbols-in-versions.html	      \
 threadsafe.html curl_global_sslset.html libcurl-env.html $(MIME) 	      \
 curl_easy_upkeep.html $(URLAPI)

all: $(PAGES)

clean:
	rm -f $(PAGES) curl_*.t libcurl.t libcurl-easy.t libcurl-multi.t \
	libcurl-share.t $(EXAMPLES) *.et

index.html: _index.html $(MAINPARTS)
	$(ACTION)

example.html: _example.html $(MAINPARTS) allex-desc.t
	$(ACTION)

# all-easy.t is generated by mkopts.pl
all-easy.t: $(OPTMAN)/Makefile.am mkopts.pl $(MAINPARTS) _CURLOPT_template.html
	perl mkopts.pl

# all-multi.t is also generated by mkopts.pl
all-multi.t: $(OPTMAN)/Makefile.am mkopts.pl $(MAINPARTS) _CURLMOPT_template.html
	perl mkopts.pl

easy_setopt_options.html: _easy_setopt_options.html $(MAINPARTS) all-easy.t
	$(ACTION)

easy_getinfo_options.html: _easy_getinfo_options.html $(MAINPARTS) all-info.t
	$(ACTION)

multi_setopt_options.html: _multi_setopt_options.html $(MAINPARTS) all-multi.t
	$(ACTION)

allex.t: $(DOCROOT)/examples/Makefile.inc _example-templ.html
	perl mkexam.pl

allex-desc.t:
	perl mkexam.pl

allfuncs.html: _allfuncs.html $(MAINPARTS)
	$(ACTION)

curl_easy_init.html: _curl_easy_init.html $(MAINPARTS) curl_easy_init.t
	$(ACTION)
curl_easy_init.t: $(MANROOT)/curl_easy_init.3
	$(MAN2HTML) < $< >$@

curl_easy_duphandle.html: _curl_easy_duphandle.html $(MAINPARTS) curl_easy_duphandle.t
	$(ACTION)
curl_easy_duphandle.t: $(MANROOT)/curl_easy_duphandle.3
	$(MAN2HTML) < $< >$@

curl_easy_perform.html: _curl_easy_perform.html $(MAINPARTS) curl_easy_perform.t
	$(ACTION)
curl_easy_perform.t: $(MANROOT)/curl_easy_perform.3
	$(MAN2HTML) < $< >$@


curl_easy_cleanup.html: _curl_easy_cleanup.html $(MAINPARTS) curl_easy_cleanup.t
	$(ACTION)
curl_easy_cleanup.t: $(MANROOT)/curl_easy_cleanup.3
	$(MAN2HTML) < $< >$@


curl_easy_setopt.html: _curl_easy_setopt.html $(MAINPARTS) curl_easy_setopt.t
	$(ACTION)
curl_easy_setopt.t: $(MANROOT)/curl_easy_setopt.3
	$(MAN2HTML) < $< >$@

curl_easy_pause.html: _curl_easy_pause.html $(MAINPARTS) curl_easy_pause.t
	$(ACTION)
curl_easy_pause.t: $(MANROOT)/curl_easy_pause.3
	$(MAN2HTML) < $< >$@

curl_easy_recv.html: _curl_easy_recv.html $(MAINPARTS) curl_easy_recv.t
	$(ACTION)
curl_easy_recv.t: $(MANROOT)/curl_easy_recv.3
	$(MAN2HTML) < $< >$@

curl_easy_send.html: _curl_easy_send.html $(MAINPARTS) curl_easy_send.t
	$(ACTION)
curl_easy_send.t: $(MANROOT)/curl_easy_send.3
	$(MAN2HTML) < $< >$@

curl_easy_getinfo.html: _curl_easy_getinfo.html $(MAINPARTS) curl_easy_getinfo.t
	$(ACTION)
curl_easy_getinfo.t: $(MANROOT)/curl_easy_getinfo.3
	$(MAN2HTML) < $< >$@

curl_version.html: _curl_version.html $(MAINPARTS) curl_version.t
	$(ACTION)
curl_version.t: $(MANROOT)/curl_version.3
	$(MAN2HTML) < $< >$@

curl_version_info.html: _curl_version_info.html $(MAINPARTS) curl_version_info.t
	$(ACTION)
curl_version_info.t: $(MANROOT)/curl_version_info.3
	$(MAN2HTML) < $< >$@

curl_free.html: _curl_free.html $(MAINPARTS) curl_free.t
	$(ACTION)
curl_free.t: $(MANROOT)/curl_free.3
	$(MAN2HTML) < $< >$@

curl_escape.html: _curl_escape.html $(MAINPARTS) curl_escape.t
	$(ACTION)
curl_escape.t: $(MANROOT)/curl_escape.3
	$(MAN2HTML) < $< >$@

curl_unescape.html: _curl_unescape.html $(MAINPARTS) curl_unescape.t
	$(ACTION)
curl_unescape.t: $(MANROOT)/curl_unescape.3
	$(MAN2HTML) < $< >$@

curl_easy_escape.html: _curl_easy_escape.html $(MAINPARTS) curl_easy_escape.t
	$(ACTION)
curl_easy_escape.t: $(MANROOT)/curl_easy_escape.3
	$(MAN2HTML) < $< >$@

curl_easy_unescape.html: _curl_easy_unescape.html $(MAINPARTS) curl_easy_unescape.t
	$(ACTION)
curl_easy_unescape.t: $(MANROOT)/curl_easy_unescape.3
	$(MAN2HTML) < $< >$@

curl_easy_upkeep.html: _curl_easy_upkeep.html $(MAINPARTS) curl_easy_upkeep.t
	$(ACTION)
curl_easy_upkeep.t: $(MANROOT)/curl_easy_upkeep.3
	$(MAN2HTML) < $< >$@

curl_getenv.html: _curl_getenv.html $(MAINPARTS) curl_getenv.t
	$(ACTION)
curl_getenv.t: $(MANROOT)/curl_getenv.3
	$(MAN2HTML) < $< >$@

curl_getdate.html: _curl_getdate.html $(MAINPARTS) curl_getdate.t
	$(ACTION)
curl_getdate.t: $(MANROOT)/curl_getdate.3
	$(MAN2HTML) < $< >$@

curl_strequal.html: _curl_strequal.html $(MAINPARTS) curl_strequal.t
	$(ACTION)
curl_strequal.t: $(MANROOT)/curl_strequal.3
	$(MAN2HTML) < $< >$@

curl_mprintf.html: _curl_mprintf.html $(MAINPARTS) curl_mprintf.t
	$(ACTION)
curl_mprintf.t: $(MANROOT)/curl_mprintf.3
	$(MAN2HTML) < $< >$@

curl_formadd.html: _curl_formadd.html $(MAINPARTS) curl_formadd.t
	$(ACTION)
curl_formadd.t: $(MANROOT)/curl_formadd.3
	$(MAN2HTML) < $< >$@

curl_formfree.html: _curl_formfree.html $(MAINPARTS) curl_formfree.t
	$(ACTION)
curl_formfree.t: $(MANROOT)/curl_formfree.3
	$(MAN2HTML) < $< >$@

curl_formget.html: _curl_formget.html $(MAINPARTS) curl_formget.t
	$(ACTION)
curl_formget.t: $(MANROOT)/curl_formget.3
	$(MAN2HTML) < $< >$@

curl_global_init.html: _curl_global_init.html $(MAINPARTS) curl_global_init.t
	$(ACTION)
curl_global_init.t: $(MANROOT)/curl_global_init.3
	$(MAN2HTML) < $< >$@

curl_global_init_mem.html: _curl_global_init_mem.html $(MAINPARTS) curl_global_init_mem.t
	$(ACTION)
curl_global_init_mem.t: $(MANROOT)/curl_global_init_mem.3
	$(MAN2HTML) < $< >$@

curl_global_cleanup.html: _curl_global_cleanup.html $(MAINPARTS) curl_global_cleanup.t
	$(ACTION)
curl_global_cleanup.t: $(MANROOT)/curl_global_cleanup.3
	$(MAN2HTML) < $< >$@

curl_global_sslset.html: _curl_global_sslset.html $(MAINPARTS) curl_global_sslset.t
	$(ACTION)
curl_global_sslset.t: $(MANROOT)/curl_global_sslset.3
	$(MAN2HTML) < $< >$@

libcurl.html: _libcurl.html $(MAINPARTS) libcurl.t
	$(ACTION)
libcurl.t: $(MANROOT)/libcurl.3
	$(MAN2HTML) < $< >$@

curl_slist_append.html: _curl_slist_append.html $(MAINPARTS) curl_slist_append.t
	$(ACTION)
curl_slist_append.t: $(MANROOT)/curl_slist_append.3
	$(MAN2HTML) < $< >$@

curl_slist_free_all.html: _curl_slist_free_all.html $(MAINPARTS) curl_slist_free_all.t
	$(ACTION)
curl_slist_free_all.t: $(MANROOT)/curl_slist_free_all.3
	$(MAN2HTML) < $< >$@

libcurl-multi.html: _libcurl-multi.html $(MAINPARTS) libcurl-multi.t
	$(ACTION)
libcurl-multi.t: $(MANROOT)/libcurl-multi.3
	$(MAN2HTML) < $< >$@

libcurl-easy.html: _libcurl-easy.html $(MAINPARTS) libcurl-easy.t
	$(ACTION)
libcurl-easy.t: $(MANROOT)/libcurl-easy.3
	$(MAN2HTML) < $< >$@

libcurl-env.html: _libcurl-env.html $(MAINPARTS) libcurl-env.gen
	$(ACTION)
libcurl-env.gen: $(MANROOT)/libcurl-env.3
	$(MAN2HTML) < $< >$@

libcurl-share.html: _libcurl-share.html $(MAINPARTS) libcurl-share.t
	$(ACTION)
libcurl-share.t: $(MANROOT)/libcurl-share.3
	$(MAN2HTML) < $< >$@

libcurl-errors.html: _libcurl-errors.html $(MAINPARTS) libcurl-errors.t
	$(ACTION)
libcurl-errors.t: $(MANROOT)/libcurl-errors.3
	$(MAN2HTMLBASIC) < $< >$@

libcurl-tutorial.html: _libcurl-tutorial.html $(MAINPARTS) libcurl-tutorial.t
	$(ACTION)
libcurl-tutorial.t: $(MANROOT)/libcurl-tutorial.3
	$(MAN2HTML) < $< >$@

curl_multi_add_handle.html: _curl_multi_add_handle.html $(MAINPARTS) curl_multi_add_handle.t
	$(ACTION)
curl_multi_add_handle.t: $(MANROOT)/curl_multi_add_handle.3
	$(MAN2HTML) < $< >$@

curl_multi_cleanup.html: _curl_multi_cleanup.html $(MAINPARTS) curl_multi_cleanup.t
	$(ACTION)
curl_multi_cleanup.t: $(MANROOT)/curl_multi_cleanup.3
	$(MAN2HTML) < $< >$@

curl_multi_fdset.html: _curl_multi_fdset.html $(MAINPARTS) curl_multi_fdset.t
	$(ACTION)
curl_multi_fdset.t: $(MANROOT)/curl_multi_fdset.3
	$(MAN2HTML) < $< >$@

curl_multi_info_read.html: _curl_multi_info_read.html $(MAINPARTS) curl_multi_info_read.t
	$(ACTION)
curl_multi_info_read.t: $(MANROOT)/curl_multi_info_read.3
	$(MAN2HTML) < $< >$@

curl_multi_init.html: _curl_multi_init.html $(MAINPARTS) curl_multi_init.t
	$(ACTION)
curl_multi_init.t: $(MANROOT)/curl_multi_init.3
	$(MAN2HTML) < $< >$@

curl_multi_wait.html: _curl_multi_wait.html $(MAINPARTS) curl_multi_wait.t
	$(ACTION)
curl_multi_wait.t: $(MANROOT)/curl_multi_wait.3
	$(MAN2HTML) < $< >$@

curl_multi_perform.html: _curl_multi_perform.html $(MAINPARTS) curl_multi_perform.t
	$(ACTION)
curl_multi_perform.t: $(MANROOT)/curl_multi_perform.3
	$(MAN2HTML) < $< >$@

curl_multi_remove_handle.html: _curl_multi_remove_handle.html $(MAINPARTS) curl_multi_remove_handle.t
	$(ACTION)
curl_multi_remove_handle.t: $(MANROOT)/curl_multi_remove_handle.3
	$(MAN2HTML) < $< >$@

curl_share_cleanup.html: _curl_share_cleanup.html $(MAINPARTS) curl_share_cleanup.t
	$(ACTION)
curl_share_cleanup.t: $(MANROOT)/curl_share_cleanup.3
	$(MAN2HTML) < $< >$@

curl_share_init.html: _curl_share_init.html $(MAINPARTS) curl_share_init.t
	$(ACTION)
curl_share_init.t: $(MANROOT)/curl_share_init.3
	$(MAN2HTML) < $< >$@

curl_share_setopt.html: _curl_share_setopt.html $(MAINPARTS) curl_share_setopt.t
	$(ACTION)
curl_share_setopt.t: $(MANROOT)/curl_share_setopt.3
	$(MAN2HTML) < $< >$@

curl_share_strerror.html: _curl_share_strerror.html $(MAINPARTS) curl_share_strerror.t
	$(ACTION)
curl_share_strerror.t: $(MANROOT)/curl_share_strerror.3
	$(MAN2HTML) < $< >$@


curl_easy_strerror.html: _curl_easy_strerror.html $(MAINPARTS) curl_easy_strerror.t
	$(ACTION)
curl_easy_strerror.t: $(MANROOT)/curl_easy_strerror.3
	$(MAN2HTML) < $< >$@


curl_multi_strerror.html: _curl_multi_strerror.html $(MAINPARTS) curl_multi_strerror.t
	$(ACTION)
curl_multi_strerror.t: $(MANROOT)/curl_multi_strerror.3
	$(MAN2HTML) < $< >$@

curl_easy_reset.html: _curl_easy_reset.html $(MAINPARTS) curl_easy_reset.t
	$(ACTION)
curl_easy_reset.t: $(MANROOT)/curl_easy_reset.3
	$(MAN2HTML) < $< >$@

curl_multi_socket.html: _curl_multi_socket.html $(MAINPARTS) curl_multi_socket.t
	$(ACTION)
curl_multi_socket.t: $(MANROOT)/curl_multi_socket.3
	$(MAN2HTML) < $< >$@

curl_multi_socket_action.html: _curl_multi_socket_action.html $(MAINPARTS) curl_multi_socket_action.t
	$(ACTION)
curl_multi_socket_action.t: $(MANROOT)/curl_multi_socket_action.3
	$(MAN2HTML) < $< >$@

curl_multi_timeout.html: _curl_multi_timeout.html $(MAINPARTS) curl_multi_timeout.t
	$(ACTION)
curl_multi_timeout.t: $(MANROOT)/curl_multi_timeout.3
	$(MAN2HTML) < $< >$@

curl_multi_setopt.html: _curl_multi_setopt.html $(MAINPARTS) curl_multi_setopt.t
	$(ACTION)
curl_multi_setopt.t: $(MANROOT)/curl_multi_setopt.3
	$(MAN2HTML) < $< >$@

curl_multi_assign.html: _curl_multi_assign.html $(MAINPARTS) curl_multi_assign.t
	$(ACTION)
curl_multi_assign.t: $(MANROOT)/curl_multi_assign.3
	$(MAN2HTML) < $< >$@

include Makefile.opts

threadsafe.gen: $(MANROOT)/libcurl-thread.3
	$(MAN2HTML) < $< >$@

threadsafe.html: _threadsafe.html threadsafe.gen $(MAINPARTS)
	$(ACTION)

allexamples.zip: $(EXAMPLESRCS)
	rm -f $@; zip -j $@ $(EXAMPLESRCS)

options-in-examples.html: _options-in-examples.html $(MAINPARTS) allex.t options-in-examples.gen
	$(ACTION)

options-in-examples.gen: allex.t options-used-in-examples.pl
	perl options-used-in-examples.pl > options-in-examples.gen

symbols-in-versions.t: $(MANROOT)/symbols-in-versions
	$(TXT2PLAIN) < $< > $@

symbols-in-versions.html: _symbols-in-versions.html $(MAINPARTS) symbols-in-versions.t
	$(ACTION)

curl_mime_init.html: _curl_mime_init.html $(MAINPARTS) curl_mime_init.gen
	$(ACTION)
curl_mime_init.gen: $(MANROOT)/curl_mime_init.3
	$(MAN2HTML) < $< >$@

curl_mime_free.html: _curl_mime_free.html $(MAINPARTS) curl_mime_free.gen
	$(ACTION)
curl_mime_free.gen: $(MANROOT)/curl_mime_free.3
	$(MAN2HTML) < $< >$@

curl_mime_addpart.html: _curl_mime_addpart.html $(MAINPARTS) curl_mime_addpart.gen
	$(ACTION)
curl_mime_addpart.gen: $(MANROOT)/curl_mime_addpart.3
	$(MAN2HTML) < $< >$@

curl_mime_name.html: _curl_mime_name.html $(MAINPARTS) curl_mime_name.gen
	$(ACTION)
curl_mime_name.gen: $(MANROOT)/curl_mime_name.3
	$(MAN2HTML) < $< >$@

curl_mime_data.html: _curl_mime_data.html $(MAINPARTS) curl_mime_data.gen
	$(ACTION)
curl_mime_data.gen: $(MANROOT)/curl_mime_data.3
	$(MAN2HTML) < $< >$@

curl_mime_data_cb.html: _curl_mime_data_cb.html $(MAINPARTS) curl_mime_data_cb.gen
	$(ACTION)
curl_mime_data_cb.gen: $(MANROOT)/curl_mime_data_cb.3
	$(MAN2HTML) < $< >$@

curl_mime_filedata.html: _curl_mime_filedata.html $(MAINPARTS) curl_mime_filedata.gen
	$(ACTION)
curl_mime_filedata.gen: $(MANROOT)/curl_mime_filedata.3
	$(MAN2HTML) < $< >$@

curl_mime_filename.html: _curl_mime_filename.html $(MAINPARTS) curl_mime_filename.gen
	$(ACTION)
curl_mime_filename.gen: $(MANROOT)/curl_mime_filename.3
	$(MAN2HTML) < $< >$@

curl_mime_subparts.html: _curl_mime_subparts.html $(MAINPARTS) curl_mime_subparts.gen
	$(ACTION)
curl_mime_subparts.gen: $(MANROOT)/curl_mime_subparts.3
	$(MAN2HTML) < $< >$@

curl_mime_type.html: _curl_mime_type.html $(MAINPARTS) curl_mime_type.gen
	$(ACTION)
curl_mime_type.gen: $(MANROOT)/curl_mime_type.3
	$(MAN2HTML) < $< >$@

curl_mime_headers.html: _curl_mime_headers.html $(MAINPARTS) curl_mime_headers.gen
	$(ACTION)
curl_mime_headers.gen: $(MANROOT)/curl_mime_headers.3
	$(MAN2HTML) < $< >$@

curl_mime_encoder.html: _curl_mime_encoder.html $(MAINPARTS) curl_mime_encoder.gen
	$(ACTION)
curl_mime_encoder.gen: $(MANROOT)/curl_mime_encoder.3
	$(MAN2HTML) < $< >$@

curl_url.html: _curl_url.html $(MAINPARTS) curl_url.gen
	$(ACTION)
curl_url.gen: $(MANROOT)/curl_url.3
	$(MAN2HTML) < $< >$@

curl_url_cleanup.html: _curl_url_cleanup.html $(MAINPARTS) curl_url_cleanup.gen
	$(ACTION)
curl_url_cleanup.gen: $(MANROOT)/curl_url_cleanup.3
	$(MAN2HTML) < $< >$@

curl_url_dup.html: _curl_url_dup.html $(MAINPARTS) curl_url_dup.gen
	$(ACTION)
curl_url_dup.gen: $(MANROOT)/curl_url_dup.3
	$(MAN2HTML) < $< >$@

curl_url_get.html: _curl_url_get.html $(MAINPARTS) curl_url_get.gen
	$(ACTION)
curl_url_get.gen: $(MANROOT)/curl_url_get.3
	$(MAN2HTML) < $< >$@

curl_url_set.html: _curl_url_set.html $(MAINPARTS) curl_url_set.gen
	$(ACTION)
curl_url_set.gen: $(MANROOT)/curl_url_set.3
	$(MAN2HTML) < $< >$@

include Makefile.examples

full: all

